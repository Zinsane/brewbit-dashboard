<div class="col-md-8 col-md-offset-2">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Edit Temperature Profile</h3>
    </div>
    <div class="panel-body">
      <%= nested_form_for @dynamic_setpoint, html: { class: 'form-horizontal' } do |f| %>
        <div class="form-group">
          <%= f.label :name, class: 'col-sm-2 control-label' %>
          <div class="col-sm-10">
            <%= f.text_field :name, class: 'form-control' %>
          </div>
        </div>
        <table id="steps" class="table table-striped">
          <thead>
            <tr>
              <th class="col-sm-1">#</th>
              <th class="col-sm-2">Temperature</th>
              <th class="col-sm-3">Duration</th>
              <th class="col-sm-2">Type</th>
              <th class="col-sm-2"><%= f.link_to_add raw('<span class="glyphicon glyphicon-plus"></span> Add Step'), :steps, :data => { :target => "#steps" }, class: 'btn btn-default btn-sm' %></th>
            </tr>
          </thead>
          <tbody>
            <%= f.fields_for :steps, :wrapper => false do |ff| %>
              <%= render partial: 'step_form', locals: { f: ff } %>
            <% end -%>
          </tbody>
        </table>

        <div class="form-group">
          <div class="col-md-offset-8 col-md-4">
            <%= f.submit 'Update Temperature Profile', class: 'btn btn-primary' %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script type='text/javascript'>
  $(document).on('nested:fieldAdded', function(event){
    var field = event.field;
    var index_field = field.find('span.step_index');
    var index_form_field = field.find('input.step_index');
    var index = $('.fields').size() ;

    index_field.text( index );
    index_form_field.val( index );
  }) ;

  $(document).on( 'change', 'input[name="step_types"]', function(e){
    var val = this.id;
    var step_type_form_field = $(this).parents('td').find('input[type="hidden"]');

    switch(val){
      case 'hold':
        step_type_form_field.val(0);
        break;
      case 'ramp':
        step_type_form_field.val(1);
        break;
    }
  });
</script>

